window.fbAsyncInit = function() {
   FB.init({
      appId      : '800212700114821',
      xfbml      : true,
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      version    : 'v2.6'
   });
};

(function(d, s, id){
   var js, fjs = d.getElementsByTagName(s)[0];
   if (d.getElementById(id)) {return;}
   js = d.createElement(s); js.id = id;
   js.src = "//connect.facebook.net/en_US/sdk.js";
   fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

// function login(){
//    console.log("login() ->");
//    FB.login(function(response){
//       if( response.status === 'connected'){
//          console.log("Connected");
//       } else if (response.status === 'not_authorized'){
//          console.log("not authorized");
//       } else{
//          alert("DUDE");
//       }
//    }, {scope: 'public_profile,user_photos,user_likes'});
// }
function makeFacebookPhotoURL( id, accessToken ) {
   return 'https://graph.facebook.com/' + id + '/picture?access_token=' + accessToken;
}

function FBLogin(callback){
   FB.login(function(response){
      if( response.status === 'connected'){
         callback(response);
         // console.log("Connected");
      } else if (response.status === 'not_authorized'){
         callback(response);
         // console.log("not authorized");
      } else{
         callback(response);
         // alert("DUDE");
      }
   }, {scope: 'public_profile,user_photos,user_likes'});
}

function getAlbums( callback ) {
   FB.api('/me/albums', {fields: 'id,cover_photo'},
   function(albumResponse) {
      if (callback) {
         callback(albumResponse);
      }
   });
}

function getPhotosForAlbumId( albumId, callback ) {
   FB.api('/'+albumId+'/photos',{fields: 'id, created_time, height, width, images'},
   function(albumPhotosResponse) {
      if (callback) {
         callback( albumId, albumPhotosResponse );
      }
   });
}

function getLikesForPhotoId( photoId ,callback ) {
   FB.api('/' + photoId+'/likes?limit=999999','GET', {"limit":"99999999"},
   function(photoLikesResponse) {
      if (callback) {
         callback(photoLikesResponse);
      }
   });
}

function getAllPhotos(callback){
   var allPhotos = [];
   var accessToken = '';
   FBLogin(function(loginResponse){
      accessToken = loginResponse.authResponse.accessToken;
      console.log(loginResponse.authResponse.accessToken);
      var i, album, deferreds = {}, listOfDeferreds = [];
      getAlbums(function(getAlbumsResponse){
         // console.log(getAlbumsResponse.data.length);
         for (i = 0; i < getAlbumsResponse.data.length; i++) {
            album = getAlbumsResponse.data[i];
            deferreds[album.id] = $.Deferred();
            listOfDeferreds.push( deferreds[album.id] );
            getPhotosForAlbumId( album.id, function( albumId, albumPhotosResponse ) {
               var i, facebookPhoto;
               for (i = 0; i < albumPhotosResponse.data.length; i++) {
                  facebookPhoto = albumPhotosResponse.data[i];
                  // console.log('album-id : ' + album.id);
                  // console.log('photo-id : '	+ facebookPhoto.id);
                  // console.log('added : '	+	facebookPhoto.created_time);
                  // console.log('url : '	+	makeFacebookPhotoURL( facebookPhoto.id, accessToken ));
                  var highResImg = facebookPhoto.images[0];
                  allPhotos.push({
                     'album_id'  : album.id,
                     'photo_id'	: facebookPhoto.id,
                     'added'	   : facebookPhoto.created_time,
                     'height'    : highResImg.height,
                     'width'     : highResImg.width,
                     'source'	   : highResImg.source
                  });
               }

            });
         }
         deferreds[albumId].resolve();
         $.when.apply($, listOfDeferreds ).then( function() {
            if (callback) {
               callback( allPhotos );
            }
         }, function( error ) {
            if (callback) {
               callback( allPhotos, error );
            }
         });
      });
   });
}

function getAllLikes(callback){

   getAllPhotos(function(allPhotosCallback){
      deferreds = {}, listOfDeferreds = [];
      var allPhotos = allPhotosCallback;
      console.log(allPhotos.length);
      var  i = 0;
      for( i = 0; i < allPhotos.length; i ++){
         // console.log(i);
         // console.log(allPhotos[i]);
         deferreds[allPhotos[i]] = $.Deferred();
         listOfDeferreds.push( deferreds[allPhotos[i]] );
         // console.log(allPhotos[i]);
         getLikesForPhotoId( allPhotos[i].photo_id, function(likesResponse){
            // console.log(allPhotos[i]);
            // allPhotos[i].likes = likesResponse.data.length;
            // console.log(likesResponse.data.length);
            // console.log("Album id : " + allPhotos[i].album_id);
            // console.log("Photo id : " + allPhotos[i].photo_id);
            // console.log("Source : " + allPhotos[i].source);
            // console.log("Height : " + allPhotos[i].height);
            // console.log("Width  : " + allPhotos[i].width);
            // console.log(allPhotos[i]);
            // allPhotos[i].likes = likes
         });
         deferreds[allPhotos[i]].resolve();
      }
      $.when.apply($, listOfDeferreds ).then( function() {
         if (callback) {
            callback( allPhotos );
         }
      }, function( error ) {
         if (callback) {
            callback( allPhotos, error );
         }
      });
   });
}

function login(){
   getAllLikes(function(allLikesResponse){
      // console.log(allLikesResponse);
   });
}
// THis is for all photos
// for(i = 0; i < allPhotos.length; i++){
//    getLikesForPhotoId(allPhotos[i].photo_id, function(likesResponse){
//       allPhotos[i].likes = likesResponse.data.length;
//       console.log(allPhotos[i]);
//       // allPhotos[i].likes = likes
//    });
// }

// function myFunction(val, callBack){
//    if(val == 1){
//       callBack(true);
//    }else{
//       callBack(false);
//    }
// }
//
// myFunction(0, function (bool){
//    if(bool){
//       alert("do stuff for when value is true");
//    }else {
//       //this condition is satisfied as 0 passed
//       alert("do stuff for when value is false");
//    }
// });
